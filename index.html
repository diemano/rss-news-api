<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Feed de Not√≠cias de TI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 1rem; margin: 0; }
    header { background: #01426a; color: white; padding: 1.5rem; text-align: center; }
    .search-box, #filtros { text-align: center; margin: 1rem auto; }
    .feeds { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1rem; }
    .card { background: white; border-radius: 6px; padding: 1rem; box-shadow: 0 2px 6px rgba(0,0,0,0.1); position: relative; }
    .tag { position: absolute; top: 1rem; right: 1rem; background: #01426a; color: white; padding: 0.2rem 0.6rem; font-size: 0.75rem; border-radius: 4px; cursor: pointer; }
    .card small { font-size: 0.8rem; color: #666; }
    .card p { font-size: 0.95rem; margin-top: 0.5rem; white-space: pre-wrap; }
    .card a.btn-link { display: inline-block; margin-top: 0.7rem; text-decoration: none; background: #00aaff; color: white; padding: 0.4rem 0.8rem; border-radius: 4px; font-weight: bold; }
    .card a.btn-link:hover { background: #0077cc; }
    #verMais { margin: 2rem auto; display: block; padding: 0.7rem 1.5rem; font-size: 1rem; background: #01426a; color: white; border: none; border-radius: 6px; cursor: pointer; }
    #verMais:hover { background: #036; }
    .filter-btn { margin: 0.3rem; padding: 0.5rem 0.8rem; border: none; border-radius: 20px; background: #ddd; cursor: pointer; }
    .filter-btn.selected { background: #01426a; color: white; font-weight: bold; }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <header>
    <h1>üß† Feed de Not√≠cias de TI</h1>
    <p>As principais not√≠cias de TI do Brasil e Mundo selecionadas.</p>
  </header>
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Buscar palavra-chave..." />
  </div>
  <div id="filtros"></div>
  <div class="feeds" id="feedContainer"></div>
  <button id="verMais">üîÑ Ver mais not√≠cias</button>
  <script>
    const feeds = [
      { nome: "TechCrunch", url: "https://techcrunch.com/feed/" },
      { nome: "The Verge", url: "https://www.theverge.com/rss/index.xml" },
      { nome: "Digital Trends", url: "https://www.digitaltrends.com/feed/" }
    ];

    let todasNoticias = [];
    let exibidas = 0;
    const porPagina = 5;
    const categoriasSet = new Set();
    const categoriasSelecionadas = new Set();

    async function carregarFeeds() {
      for (const feed of feeds) {
        try {
          const r = await fetch("/.netlify/functions/rss?url=" + encodeURIComponent(feed.url));
          const noticias = await r.json();
          todasNoticias.push(...noticias.map(n => ({ ...n, fonte: feed.nome })));
        } catch (e) {
          console.warn("Erro no feed", feed.nome);
        }
      }
      mostrarNoticias();
    }

    async function mostrarNoticias() {
      const container = document.getElementById("feedContainer");
      const fim = exibidas + porPagina;
      for (let i = exibidas; i < fim && i < todasNoticias.length; i++) {
        const n = todasNoticias[i];
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<small>${new Date(n.pubDate).toLocaleDateString("pt-BR")} ‚Ä¢ ${n.fonte}</small><p>‚è≥ Gerando conte√∫do com IA...</p>`;
        document.getElementById("feedContainer").appendChild(div);

        const dados = await fetch("/.netlify/functions/generate-summary", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ title: n.title, description: n.contentSnippet || n.description, source: n.fonte })
        }).then(r => r.json());

        div.innerHTML = `
          <div class="tag" onclick="filtrarPorCategoria('${dados.categoria}', this)">${dados.categoria}</div>
          <small>${new Date(n.pubDate).toLocaleDateString("pt-BR")} ‚Ä¢ ${n.fonte}</small>
          <p>${dados.resumo}</p>
          <a class="btn-link" href="${n.link}" target="_blank">üìé Ler not√≠cia original</a>
        `;
        div.setAttribute("data-categoria", dados.categoria);
        div.setAttribute("data-titulo", n.title.toLowerCase());

        categoriasSet.add(dados.categoria);
      }
      exibidas = fim;
      gerarFiltros();
    }

    function gerarFiltros() {
      const container = document.getElementById("filtros");
      container.innerHTML = "";
      categoriasSet.forEach(cat => {
        const btn = document.createElement("button");
        btn.className = "filter-btn" + (categoriasSelecionadas.has(cat) ? " selected" : "");
        btn.innerText = cat;
        btn.onclick = () => {
          if (categoriasSelecionadas.has(cat)) {
            categoriasSelecionadas.delete(cat);
          } else {
            categoriasSelecionadas.add(cat);
          }
          gerarFiltros();
          aplicarFiltro();
        };
        container.appendChild(btn);
      });
    }

    function filtrarPorCategoria(cat, el) {
      if (categoriasSelecionadas.has(cat)) {
        categoriasSelecionadas.delete(cat);
      } else {
        categoriasSelecionadas.add(cat);
      }
      gerarFiltros();
      aplicarFiltro();
    }

    function aplicarFiltro() {
      const cards = document.querySelectorAll(".card");
      cards.forEach(card => {
        const categoria = card.getAttribute("data-categoria");
        const titulo = card.getAttribute("data-titulo");
        const termo = document.getElementById("searchInput").value.toLowerCase();
        const atendeBusca = titulo.includes(termo);
        const atendeCat = categoriasSelecionadas.size === 0 || categoriasSelecionadas.has(categoria);
        card.classList.toggle("hidden", !(atendeBusca && atendeCat));
      });
    }

    document.getElementById("searchInput").addEventListener("input", aplicarFiltro);
    document.getElementById("verMais").addEventListener("click", mostrarNoticias);
    carregarFeeds();
  </script>
</body>
</html>
